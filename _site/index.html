<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Содержание | Тестовое задание</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="Содержание" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Тестовое задание на позицию технического писателя от Григорьевой И.В." />
<meta property="og:description" content="Тестовое задание на позицию технического писателя от Григорьевой И.В." />
<link rel="canonical" href="http://localhost:4000/" />
<meta property="og:url" content="http://localhost:4000/" />
<meta property="og:site_name" content="Тестовое задание" />
<script type="application/ld+json">
{"name":"Тестовое задание","description":"Тестовое задание на позицию технического писателя от Григорьевой И.В.","@type":"WebSite","url":"http://localhost:4000/","headline":"Содержание","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Тестовое задание" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Тестовое задание</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">Об авторе</a><a class="page-link" href="/">Содержание</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="home"><h1 class="page-heading">Содержание</h1><ol>
  <li>
    <p><a href="#uni">Стандарт <strong>Unicode</strong></a></p>
  </li>
  <li>
    <p><a href="#utf16">Кодировка <strong>UTF-16</strong></a></p>
  </li>
  <li>
    <p><a href="#utf8">Кодировка <strong>UTF-8</strong></a></p>
  </li>
  <li>
    <p><a href="#vs"><strong>UTF-8</strong> vs <strong>UTF-16</strong>: преимущества и недостатки</a></p>
  </li>
</ol>

<h1 id="Стандарт-unicode"><a name="uni"></a>Стандарт <strong>Unicode</strong></h1>

<p><strong>Unicode</strong> – это промышленный стандарт кодирования для единого универсального цифрового представления символов всех письменностей мира, а также описания всех известных на сегодня областей знаний с используемыми в них обозначениями.</p>

<p>Стандарт включает универсальный набор символов <strong>UCS</strong> (Universal Character Set) и набор кодировок <strong>UTF</strong> (Unicode Transformation Format), но часто, говоря о <strong>Unicode</strong>, имеют в виду именно первую часть стандарта – универсальный набор символов. Этот набор символов описывается кодовой таблицей, которая ставит в соответствие хранимым символам уникальные номера позиций в таблице.</p>

<p>Номера будем называть кодовыми точками, они описываются неотрицательными целыми числами в шестнадцатеричной системе счисления с префиксом U+, например, буква ‘F’ имеет код U+0046. Эта таблица хранит символы всех современных алфавитов, устаревших и даже мертвых языков, иероглифы, специальные знаки, такие как элементы формул, музыкальные знаки, знаки валют и даже эмодзи.</p>

<h2 id="Предпосылки-и-история">Предпосылки и история</h2>

<p>Одной из самых ранних и употребимых кодовых таблица была <strong>ASCII</strong> (American Standart Code for Information Interchange), разработанная в США в 1963 году. В исходном семибитном варианте <strong>ASCII</strong> содержала заглавные и строчные буквы латинского алфавита, цифры, знаки препинания и управляющие символы, она представлена в таблице 1. Например, в этой кодовой таблице символ ‘F’ имеет номер 100 0110<sub>2</sub> или 46<sub>16</sub>. Аббревиатуры используются в ней для обозначения управляющих и непечатных символов, не имеющих графического представления. Первые 128 символов кодировки <strong>ASCII</strong> были перенесены в <strong>Unicode</strong> в неизменном виде, их номера в двух кодовых таблицах совпадают.</p>

<p>Позже стал использоваться 8 битный вариант <strong>ASCII</strong>, что привело к увеличение таблицы в двое. Вторая половина таблицы из 128 символов использовалась для хранения национальных алфавитов. Небольшой объем таблицы не позволял хранить сразу несколько национальных алфавитов, что привело к появлению различных национальных вариантов таблицы <strong>ASCII</strong>. Такой подход исключал представления многоязыковых текстов и создавал существенные трудности при попытке использовать текст из другой кодовой таблицы. Кроме того, нашлись языки, количество букв в алфавитах которых превышало количество доступных позиций во второй половине таблицы. Также возникали сложности, связанные с использованием шрифтов, так как для каждой национальной кодировки создавался свой шрифт, даже при условии, что многие символы в разных национальных кодировках совпадали. Неоспоримым плюсом <strong>ASCII</strong> и других восьмибитных кодировок является фиксированная длина представления каждого символа и крайняя экономичность.</p>

<h3 id="Таблица-1-Кодовая-таблица-ascii">Таблица 1. Кодовая таблица ASCII</h3>

<p><img src="/images/ascii.png" alt="&quot;ASCII&quot;" /></p>

<p>С появлением и развитием Интернет, нарастающими процессами глобализации и интеграции в обществе возникла необходимость в создании единой кодовой таблицы, включающей все национальные алфавиты, независимой от платформ, операционных систем, государств, в которых она используется. Такая таблица позволила бы воспроизвести любой текст в исходном виде в любой точке мира и на любом компьютере.</p>

<p>В 1991 году была создана некоммерческая организация <a href="https://home.unicode.org">Unicode Consortium</a>, результатом работы которой и стал <strong>Unicode</strong>. Первая версия стандарта вышла в октябре 1991 года. Стандарт постоянно дополняется и совершенствуется, при этом символы, которые ранее добавленные в кодовую таблицу никогда не меняют своих позиций в последующих версиях. Последняя 12 версия стандарта была выпущена в марте 2019 года. Очевидно, что кодовая таблица для хранения всех (или подавляющего большинства) символов, используемых современной цивилизацией, должна иметь огромный объем. Первая версия <strong>Unicode</strong> была описана как таблица с фиксированным размером для хранения одной кодовой точки в 16 бит, то есть общее количество кодовых точек 2<sup>16</sup> (64 536). Позже, когда было принято решение хранить все известные символы, в том числе и устаревшие, возникла необходимость расширить кодовое пространство. В настоящее время номера в кодовой таблице располагаются в диапазоне от U+00000 до U+10FFFF.</p>

<h2 id="Плоскости-unicode">Плоскости Unicode</h2>

<p>Для удобства кодовая таблица была разделена на плоскости. В каждой плоскости последние 4 разряда изменяются от 0000 до FFFF, а номера первых разрядов дают номер плоскости и изменяются от 0 до 10<sub>16</sub>. Каждая плоскость состоит из 2<sup>16</sup>=65 536 кодовых точек, а вся таблица из 17*65 536, но часть плоскостей и отдельных кодовых точек в настоящее время не используется. Номера и названия плоскостей представлены в таблице 2.</p>

<h3 id="Таблица-2-Плоскости-unicode">Таблица 2. Плоскости <strong>Unicode</strong></h3>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Плоскость</th>
      <th style="text-align: center">Английское название</th>
      <th style="text-align: center">Аббревиатура</th>
      <th style="text-align: center">Русское название</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">0</td>
      <td style="text-align: center">Basic Multilangual Plane</td>
      <td style="text-align: center">BMP</td>
      <td style="text-align: center">Основная многоязычная плоскость</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Supplementary Multilangual Plane</td>
      <td style="text-align: center">SMP</td>
      <td style="text-align: center">Дополнительная многоязычная плоскость</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Supplementary Ideographic Plane</td>
      <td style="text-align: center">SIP</td>
      <td style="text-align: center">Дополнительная идеографическая плоскость</td>
    </tr>
    <tr>
      <td style="text-align: center">3</td>
      <td style="text-align: center">Tertiary Ideographic Plane</td>
      <td style="text-align: center">TIP</td>
      <td style="text-align: center">Третичная идеографическая плоскость</td>
    </tr>
    <tr>
      <td style="text-align: center">4-13</td>
      <td style="text-align: center">не используются</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: center">14</td>
      <td style="text-align: center">Supplementary Special-purpose Plane</td>
      <td style="text-align: center">SSP</td>
      <td style="text-align: center">Специализированная дополнительная плоскость</td>
    </tr>
    <tr>
      <td style="text-align: center">15</td>
      <td style="text-align: center">Supplementary Private Use Area-A</td>
      <td style="text-align: center">SPUA-A</td>
      <td style="text-align: center">Дополнительная область для частного использования A</td>
    </tr>
    <tr>
      <td style="text-align: center">15</td>
      <td style="text-align: center">Supplementary Private Use Area-B</td>
      <td style="text-align: center">SPUA-B</td>
      <td style="text-align: center">Дополнительная область для частного использования B</td>
    </tr>
  </tbody>
</table>

<p>Наиболее употребимой частью <strong>Unicode</strong> является нулевая основная многоязычная плоскость (<strong>BMP</strong>), ее структура представлена на рисунке 1. Она содержит символы большинства современных письменностей, спецсимволы, китайско-японские иероглифы и корейские буквы (далее ККЯ). В нулевой плоскости адреса с U+0D800 по U+0DFFF отведены для нужд кодировки <strong>UTF-16</strong>, под так называемые суррогатные пары. Они описаны в разделе, посвященному кодировке <strong><a href="#utf16">UTF-16</a></strong>. В дальнейшем, в случае если кодовая точка описывается четырехразрядным числом, то имеется в виду именно плоскость <strong>BMP</strong>, во всех остальных случаях кодовая точка будет описываться пятиразрядным числом.</p>

<p><img src="/images/bmp.png" alt="Рисунок 1. Основная многоязычная плоскость **Unicode**" /></p>

<h3 id="Рисунок-1-Основная-многоязычная-плоскость-unicode">Рисунок 1. Основная многоязычная плоскость <strong>Unicode</strong></h3>

<p>Плоскость 1 (дополнительная многоязычная плоскость) содержит символы исторических (устаревших) письменностей, музыкальные и математические символы.</p>

<p>Плоскость 2 отведена под не вошедшие в плоскость 0 иероглифы ККЯ, плоскость 3 – редко используемые китайские иероглифы и исторические формы китайского письма. Плоскости с 4 по 13 в настоящее время не используются.</p>

<p>Плоскость 14 отведена для тегов и символов, используемых по особому назначению. Некоторые области адресов отведены для частного использования, это область от U+0E000 до U+0F8FF в основной многоязычной плоскости и плоскости 15 и 16 целиком.</p>

<h2 id="Алгоритмы-нормализации-и-двунаправленное-письмо">Алгоритмы нормализации и двунаправленное письмо</h2>

<p>Представление символов в <strong>Unicode</strong> не является абсолютно однозначным. Символы в <strong>Unicode</strong> подразделяются на базовые и комбинируемые. Комбинируемые символы указываются за базовыми, к которым они применяются, и изменяют их отображение. Например, русскую букву ‘Й’ можно представить в виде символа ‘И’ (U+0418) и комбинируемого символа ‘  ̆ ‘ (U+0306). В результате сложилась ситуация, когда одну и туже букву можно записать и как один символ и как сочетание базового и комбинируемого символов, кроме того, к одному символу может применяться сразу несколько знаков, и они могут упоминаться в любом порядке. Это затрудняет побайтное сравнение строк, содержащих такие символы. Для преодоления подобных трудностей в <strong>Unicode</strong> были описаны алгоритмы нормализации, которые позволяют приводить тексты к некоторому стандартному виду. Для нормализации используется декомпозиция – разложение символов на составляющие согласно строгим правилам и композиция – соединение базовых и комбинируемых символов в один. Подробнее алгоритмы нормализации описаны на <a href="https://habr.com/ru/post/45489/">habr</a>.</p>

<p>Другой сложностью, связанной с использованием <strong>Unicode</strong>, является двунаправленное письмо. Стандарт Unicode поддерживает направление письма слева направо, справа налево, а также двунаправленное письмо. При этом многие текстовые редакторы, поддерживающие Unicode, не поддерживают двунаправленное письмо.</p>

<h2 id="Кодировки">Кодировки</h2>

<p>Кодовые точки в таблице <strong>Unicode</strong> правильно будет рассматривать как абстрактные числа, за их представление в памяти компьютера отвечают системы кодирования или кодировки.</p>

<p>Кодировка – это способ хранения символов в виде последовательности битов. Для кодовой таблицы <strong>Unicode</strong> было предложено несколько кодировок: <strong>UTF-8</strong>, <strong>UTF-16</strong> (<strong>UTF-16BE</strong> и <strong>UTF-16LE</strong>), <strong>UTF-32</strong>, <strong>EUC</strong>.</p>

<p>Кодировки семейства <strong>UTF</strong> значительно отличаются друг от друга. Кодировка <strong>UTF-32</strong> является кодировкой с постоянной длинной, в ней на описание каждого символа расходуется 4 байта. Очевидно, что такое представление является крайне неэкономичным: файл, который в <strong>ASCII</strong> занимал N байт теперь потребует 4*N.</p>

<p>В отличие от <strong>UTF-32</strong> кодировки <strong>UTF-8</strong> и <strong>UTF-16</strong> относятся к кодировкам с переменной длиной, цифры 8 и 16 в их названиях обозначают минимальное количество бит для описания символа. Это означает, что на описание символа в кодировке <strong>UTF-8</strong> может быть затрачено 8, 16, 24 или 32 бита, но при этом в <strong>UTF-16</strong> только 16 или 32 бита.</p>

<p>Как пользоваться такой кодировкой? Если описание одного символа не имеет постоянной длины, то как понять, когда заканчивается описание одного символа и начинается описание следующего? В следующих разделах рассмотрим использование кодировок <strong><a href="#utf16">UTF-16</a></strong> и <strong><a href="#utf8">UTF-8</a></strong> подробнее, а также их <a href="#vs">преимущества и недостатки</a>.</p>

<h1 id="Кодировка-utf-16"><a name="utf16"></a>Кодировка <strong>UTF-16</strong></h1>

<p>Кодировка <strong>UTF-16</strong> описывает способ кодирования символов <strong>Unicode</strong> в виде 16 битных или 32 битных последовательностей.</p>

<p>Кодировка позволяет кодировать символы в диапазонах с U+0000 по U+D7FF и с U+E000 по U+10FFFF, но как уже упоминалось раннее оставшийся диапазон с U+D800 по U+DFFF является служебным и за кодовыми точками из него не закреплено символов. Он зарезервирован для нужд кодировки <strong>UTF-16</strong>.</p>

<p>Символы из диапазонов с U+0000 по U+D7FF и c U+E000 по U+FFFF в <strong>UTF-16</strong> представляются 16 битными последовательностями. Последнее доступное для кодирования в 16 битах значение U+FFFF в двоичном виде имеет представление 11111111 11111111<sub>2</sub>, очевидно, на этом выразительные способности 16 бит исчерпаны.</p>

<p>Символы из диапазона U+10000 по U+10FFFF представляются 32 битными последовательностями, их еще называют суррогатными парами. Кодирование с использованием 16 битных и 32-битных последовательностей существенно различается. Поэтому рассмотрим для начала кодирование 16 битными последовательностями.</p>

<p>Если в кодировке <strong>ASCII</strong> для представления символа ‘F’ достаточно было 7 бит (8 в восьмибитном варианте <strong>ASCII</strong>), то теперь в <strong>UTF-16</strong> на это придется затратить 16 бит:</p>

<p>00000000 01000110<sub>2</sub>.</p>

<p>Нетрудно заметить, что последние семь бит в <strong>UTF-16</strong> совпадают с кодом буквы в <strong>ASCII</strong>. Добавление еще одного байта расширяет пространство символов, которые можно описать с использованием 16 бит, до всех символов основной многоязычной плоскости. С другой стороны, возникает вопрос: почему байт был добавлен в начале, а не в конце?
 Вместо приведенной выше последовательности бит можно было бы записать</p>

<p>01000110 00000000<sub>2</sub>.</p>

<p>И действительно, такая кодировка тоже используется. Это способ называется Big Endian, так как код хранится в старшем байте, для этой кодировке используют обозначение <strong>UTF-16BE</strong>.  Первый способ, когда нули дописываются слева, называется Little Endian, потому что в этом случае код хранится в младшем байте, для него используется обозначение <strong>UTF-16LE</strong>. Здесь при дальнейшем рассмотрении мы всегда будем иметь в виду <strong>UTF-16LE</strong>.</p>

<p>Рассмотрим теперь представление символов <strong>Unicode</strong> из диапазона с U+10000 по U+10FFFF в виде суррогатных пар. Суррогатные пары формируются согласно следующей схеме:</p>

<ol>
  <li>Из исходной кодовой точки вычитается U+10000. В результате получается 	
значение от U+00000 до U+FFFFF, которое можно записать в 20 битах. Получившаяся последовательность делится пополам по 10 бит.</li>
  <li>Старшие 10 бит дополняются слева нулями до 16 бит и суммируются с D800<sub>16</sub>, результат дает первые 16 бит – лидирующее слово суррогатной пары. Значение будет располагаться в диапазоне от D800<sub>16</sub> до DBFF<sub>16</sub>.</li>
  <li>Младшие 10 бит также дополняются слева нулями до 16 бит и суммируются с DС00<sub>16</sub>, результат дает вторые 16 бит – последующее слово суррогатной пары. Значение будет располагаться в диапазоне от DС00<sub>16</sub> до DFFF<sub>16</sub>.</li>
</ol>

<p>Рассмотрим пример вычисления суррогатной пары для кодовой точки U+3AF04.</p>
<ol>
  <li>
    <p>После вычитания из U+3AF04 кода U+10000 получаем U+2AF04. Приводим получившееся значение к 
двоичному виду:</p>

    <table>
      <thead>
        <tr>
          <th style="text-align: center">2</th>
          <th style="text-align: center">A</th>
          <th style="text-align: center">F</th>
          <th style="text-align: center">0</th>
          <th style="text-align: center">4</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align: center">0010</td>
          <td style="text-align: center">1010</td>
          <td style="text-align: center">11  |  11</td>
          <td style="text-align: center">0000</td>
          <td style="text-align: center">0100</td>
        </tr>
      </tbody>
    </table>

    <p>Делим получившуюся последовательность бит пополам:</p>

    <table>
      <thead>
        <tr>
          <th style="text-align: center">первые 10 бит</th>
          <th style="text-align: center">вторые 10 бит</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align: center">0010 1010 11</td>
          <td style="text-align: center">11 0000 0100</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>К старшим 10 битам приписываем слева 6 нулей, получаем 0000 0000 1010 1011<sub>2</sub>, 
складываем с D800<sub>16</sub> (1101 1000 0000 0000<sub>2</sub>), получаем 1101 1000 1010 1011<sub>2</sub> (D8AB<sub>16</sub>):</p>

    <table>
      <tbody>
        <tr>
          <td>слагаемое 1</td>
          <td>0000 0000 1010 1011<sub>2</sub></td>
          <td>00AB<sub>16</sub></td>
        </tr>
        <tr>
          <td>слагаемое 2</td>
          <td>1101 1000 0000 0000<sub>2</sub></td>
          <td>D800<sub>16</sub></td>
        </tr>
        <tr>
          <td>сумма</td>
          <td>1101 1000 1010 1011<sub>2</sub></td>
          <td>D8AB<sub>16</sub></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>К младшим 10 битам приписываем слева 6 нулей, получаем 0000 0011 0000 0100<sub>2</sub>,
складываем с DС00<sub>16</sub> (1101 1100 0000 0000<sub>2</sub>), получаем 1101 1111 0000 0100<sub>2</sub> (DF04<sub>16</sub>):</p>

    <table>
      <tbody>
        <tr>
          <td>слагаемое 1</td>
          <td>0000 0011 0000 0100<sub>2</sub></td>
          <td>0304<sub>16</sub></td>
        </tr>
        <tr>
          <td>слагаемое 2</td>
          <td>1101 1100 0000 0000<sub>2</sub></td>
          <td>DC00<sub>16</sub></td>
        </tr>
        <tr>
          <td>сумма</td>
          <td>1101 1111 0000 0100<sub>2</sub></td>
          <td>DF04<sub>16</sub></td>
        </tr>
      </tbody>
    </table>
  </li>
</ol>

<p>В результате получим код в <strong>UTF-16</strong> D8AB DF04<sub>16</sub>.</p>

<p>Как понять с каким представлением (16 или 32 битным) мы имеем дело при работе с очередными 16 битами? Это всегда можно определить по первым 6 битам. Так как при кодировании точек из диапазона с U+0000 по U+D7FF первые 6 бит изменяются в диапазоне от 0000 00 до 1101 01. При кодировании символов из диапазона U+E000 до U+FFFF первые 6 бит изменяются в диапазоне 1110 00 до 1111 11. У первого слова суррогатной пары первые 6 бит имеют значение 1101 10, у второго – 1101 11. Эти диапазоны не имеют общих точек, таким образом описанное представление является однозначным, оно также описано в таблице 3.</p>

<h3 id="Таблица-3-Диапазоны-кодов-используемые-для-различных-представлений-в-utf-16">Таблица 3. Диапазоны кодов, используемые для различных представлений в <strong>UTF-16</strong></h3>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Диапазон кодов</th>
      <th style="text-align: center">Первые 6 бит</th>
      <th style="text-align: center">Представление</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">0000..D7FF</td>
      <td style="text-align: center">0000 00 .. 1101 01</td>
      <td style="text-align: center">16-битное слово</td>
    </tr>
    <tr>
      <td style="text-align: center">D800..DBFF</td>
      <td style="text-align: center">1101 10</td>
      <td style="text-align: center">первое слово суррогатной пары</td>
    </tr>
    <tr>
      <td style="text-align: center">DC00..DFFF</td>
      <td style="text-align: center">1101 11</td>
      <td style="text-align: center">второе слово суррогатной пары</td>
    </tr>
    <tr>
      <td style="text-align: center">E000..FFFF</td>
      <td style="text-align: center">1110 00 .. 1111 11</td>
      <td style="text-align: center">16-битное слово</td>
    </tr>
  </tbody>
</table>

<p>Все 20 битные последовательности кодируют 2<sup>20</sup> кодовых точек, 16 битные  -  2<sup>16</sup>, но из них исключается диапазон U+D800 до U+DFFF – это 2048 точек, итого 2<sup>20</sup>+2<sup>16</sup> – 2048 = 1 112 064 символов можно закодировать с использование кодировки <strong>UTF-16</strong>.</p>

<p>Представим, что у нас есть файл или поток, из которого нужно прочитать последовательность символов в кодировке <strong>UTF-16</strong>. Как понять какой вариант  <strong>BE</strong> или <strong>LE</strong>  используется? Для этого в начале файла добавляются дополнительные специальные двухбайтовые метки порядка байтов <strong>BOM</strong> (Byte Order Mark). Первые два байта U+FEFF указывают, что данные в формате <strong>BE</strong>, если U+FFFE - то это <strong>LE</strong>. Эти коды не используются в <strong>Unicode</strong> для кодирования символов, поэтому принять их за коды символов нельзя. Если кодировка для файла указана явно (<strong>UTF-16LE</strong> или <strong>UTF-16BE</strong>), то в этом случае метку можно не указывать.</p>

<h1 id="Кодировка-utf-8"><a name="utf8"></a>Кодировка <strong>UTF-8</strong></h1>

<p><strong>UTF-8</strong> позволяет кодировать символы <strong>Unicode</strong> в 8, 16, 24 или 32 битах. На сегодняшний день этот стандарт является доминирующем в Интернет. Формат был разработан в 1992 году Кеном Томпсоном и Робом Пайком.</p>

<p>Кодирование с использованием <strong>UTF-8</strong> сходно с кодированием с использованием <strong>UTF-16</strong>. Процесс кодирования можно разбить на 2 основных этапа:</p>

<ol>
  <li>Определение количества восьмибитных слов, необходимых для кодирования символа.</li>
  <li>Запись кодовой точки в заданное количество восьмибитных слов, для этого необходимо:
    <ul>
      <li>заполнить маркировочные биты;</li>
      <li>записать кодовую точку в оставшиеся биты, начиная с последнего;</li>
      <li>оставшиеся биты заполнить нулями.</li>
    </ul>
  </li>
</ol>

<p>Маркировочные биты предназначены для того, чтобы помечать первые восьмибитные слова при кодировке, с указанием на то, сколько слов будет использоваться, а также последующие слова.</p>

<p>Теперь рассмотрим эти этапы подробнее. Определить количество восьмибитных слов необходимое для кодирования символа можно по таблице 4. В таблице представлены диапазоны кодовых точек таблицы <strong>Unicode</strong>, количество слов необходимое для записи в <strong>UTF-8</strong>, а также максимальное количество бит, необходимое для записи максимального числа в диапазоне.</p>

<h3 id="Таблица-4-Диапазоны-символов-по-количеству-восьмибитных-слов-для-их-кодирования">Таблица 4. Диапазоны символов по количеству восьмибитных слов для их кодирования</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Диапазон номеров символов</th>
      <th style="text-align: center">Требуемое количество восьмибитных слов</th>
      <th style="text-align: center">Максимальное количество бит</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">U+0000..U+007F</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">7</td>
    </tr>
    <tr>
      <td style="text-align: center">U+0080..U+07FF</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">11</td>
    </tr>
    <tr>
      <td style="text-align: center">U+0800..U+FFFF</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">16</td>
    </tr>
    <tr>
      <td style="text-align: center">U+10000..U+10FFFF</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">21</td>
    </tr>
  </tbody>
</table>

<p>Символы, которые кодируются одном словом, представимы 7 битами, при записи числа в 8 битах старший бит в этом диапазоне всегда равен 0. Например символ ‘F’ можно представить также как и в <strong>ASCII</strong>:</p>

<p>01000110<sub>2</sub>.</p>

<p>Поэтому, если символ представляется одним восьмибитным словом, то оно всегда начинается с нулевого бита. Файл, состоящий из первых 128 символов кодовой таблицы <strong>Unicode</strong> в этой кодировке, совместим с <strong>ASCII</strong>.</p>

<p>В случае, когда для кодирования символа необходимо использовать 2 восьмибитных слова, первые три бита ведущего слова устанавливаются в 110<sub>2</sub>, а первые два бита второго слова устанавливаются в 10<sub>2</sub>.</p>

<p>Если же кодовую точку необходимо разместить в 3 или 4 восьмибитных словах, то первые биты первых слов маркируются 1110<sub>2</sub> и 11110<sub>2</sub> соответственно, а все последующие слова маркируются двумя первыми битами 10<sub>2</sub>. В таблице 5 представлены шаблоны для представления кодовых точек в <strong>UTF-8</strong> в виде 1, 2, 3 и 4 восьмибитных слов. Столбец «Количество значащих бит» показывает сколько значащих бит остается в представлении за вычетом маркировочных, этот столбец полностью совпадает со столбцом «Максимальное количество бит» таблицы 4, что объясняет выбор диапазонов для представления кодовых точек в кодировке <strong>UTF-8</strong>.</p>

<h3 id="Таблица-5-Шаблоны-кодирования-для-различного-количества-восьмибитных-слов">Таблица 5. Шаблоны кодирования для различного количества восьмибитных слов</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Количество слов</th>
      <th style="text-align: center">Количество значащих бит</th>
      <th style="text-align: left">Шаблон</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">7</td>
      <td style="text-align: left">0xxxxxxx</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">11</td>
      <td style="text-align: left">110xxxxx 10xxxxxx</td>
    </tr>
    <tr>
      <td style="text-align: center">3</td>
      <td style="text-align: center">16</td>
      <td style="text-align: left">1110xxxx 10xxxxxx 10xxxxxx</td>
    </tr>
    <tr>
      <td style="text-align: center">4</td>
      <td style="text-align: center">21</td>
      <td style="text-align: left">11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td>
    </tr>
  </tbody>
</table>

<p>В качестве примера рассмотрим процесс кодирования символа U+3AF04 в <strong>UTF-8</strong>.</p>

<ol>
  <li>
    <p>Согласно таблице 4, символ U+3AF04 принадлежит последнему диапазону, для кодировки этого символа 
потребуется 4 байта.</p>
  </li>
  <li>
    <p>Запишем слово в двоичной системе счисления и применим схему кодирования, описанную выше.</p>

    <table>
      <thead>
        <tr>
          <th style="text-align: center">3</th>
          <th style="text-align: center">A</th>
          <th style="text-align: center">F</th>
          <th style="text-align: center">0</th>
          <th style="text-align: center">4</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align: center">0011</td>
          <td style="text-align: center">1010</td>
          <td style="text-align: center">1111</td>
          <td style="text-align: center">0000</td>
          <td style="text-align: center">0100</td>
        </tr>
      </tbody>
    </table>

    <ol>
      <li>
        <p>Запишем шаблон и подставим в него маркировочные биты, 
оставшиеся позиции заполним x:</p>

        <table>
          <thead>
            <tr>
              <th style="text-align: center">байт 1</th>
              <th style="text-align: center">байт 2</th>
              <th style="text-align: center">байт 3</th>
              <th style="text-align: center">байт 4</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="text-align: center">11110xxx</td>
              <td style="text-align: center">10xxxxxx</td>
              <td style="text-align: center">10xxxxxx</td>
              <td style="text-align: center">10xxxxxx</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>
        <p>Запишем биты символа на оставшиеся позиции начиная с конца. Распределение битов символа 
по битам кода будет иметь вид:</p>

        <table>
          <thead>
            <tr>
              <th style="text-align: center">байт 1</th>
              <th style="text-align: center">байт 2</th>
              <th style="text-align: center">байт 3</th>
              <th style="text-align: center">байт 4</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="text-align: center">00</td>
              <td style="text-align: center">11  1010</td>
              <td style="text-align: center">1111  00</td>
              <td style="text-align: center">00  0100</td>
            </tr>
          </tbody>
        </table>

        <p>В результате получим следующее представление кодовой точки, в котором остается незаполненным один бит:</p>

        <table>
          <thead>
            <tr>
              <th style="text-align: center">байт 1</th>
              <th style="text-align: center">байт 2</th>
              <th style="text-align: center">байт 3</th>
              <th style="text-align: center">байт 4</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="text-align: center">1111 0x00</td>
              <td style="text-align: center">1011 1010</td>
              <td style="text-align: center">1011 1100</td>
              <td style="text-align: center">1000 0100</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>
        <p>Подставив 0 на место незаполненного бита, получим:</p>

        <table>
          <thead>
            <tr>
              <th style="text-align: center">байт 1</th>
              <th style="text-align: center">байт 2</th>
              <th style="text-align: center">байт 3</th>
              <th style="text-align: center">байт 4</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="text-align: center">1111 0000</td>
              <td style="text-align: center">1011 1010</td>
              <td style="text-align: center">1011 1100</td>
              <td style="text-align: center">1000 0100</td>
            </tr>
          </tbody>
        </table>
      </li>
    </ol>
  </li>
</ol>

<p>В итоге получим F0BA BC84<sub>16</sub>.</p>

<p>В таблице 6 представлены примеры кодировки символов из разных диапазонов в 1, 2, 3 и 4 словах.</p>

<h3 id="Таблица-6-Примеры-кодирования-символов-из-различных-диапазонов">Таблица 6. Примеры кодирования символов из различных диапазонов</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Символ</th>
      <th style="text-align: center">Шестнадцатеричный код символа</th>
      <th style="text-align: center">Двоичный код символа</th>
      <th style="text-align: center">UTF-8 в двоичном виде</th>
      <th style="text-align: center">UTF-8 в шестнадцатеричном виде</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">%</td>
      <td style="text-align: center">U+0025</td>
      <td style="text-align: center">100101</td>
      <td style="text-align: center">00100101</td>
      <td style="text-align: center">25</td>
    </tr>
    <tr>
      <td style="text-align: center">گ</td>
      <td style="text-align: center">U+06AF</td>
      <td style="text-align: center">110 10101111</td>
      <td style="text-align: center">11011010 10101111</td>
      <td style="text-align: center">DA AF</td>
    </tr>
    <tr>
      <td style="text-align: center">☺</td>
      <td style="text-align: center">U+263a</td>
      <td style="text-align: center">100110 00111010</td>
      <td style="text-align: center">11100010 10011000 10111010</td>
      <td style="text-align: center">E2 98 BA</td>
    </tr>
    <tr>
      <td style="text-align: center">𐍈</td>
      <td style="text-align: center">U+10348</td>
      <td style="text-align: center">1 00000011 01001000</td>
      <td style="text-align: center">11110000 10010000 10001101 10001000</td>
      <td style="text-align: center">F0 90 8D 88</td>
    </tr>
  </tbody>
</table>

<p>Для того, чтоб показать, что файл или поток записан в кодировке <strong>UTF-8</strong> в его начале ставится маркер последовательности байтов <strong>BOM</strong> из трех байтов: EF BB BF<sub>16</sub>.</p>

<h1 id="utf-8-vs-utf-16-преимущества-и-недостатки"><a name="vs"></a><strong>UTF-8</strong> vs <strong>UTF-16</strong>: преимущества и недостатки</h1>

<p>Сравним два способа кодирования <strong>UTF-8</strong> и <strong>UTF-16</strong>, для этого опишем преимущества и недостатки каждого из них.</p>

<h3 id="Преимущества-utf-8">Преимущества <strong>UTF-8</strong>:</h3>

<ol>
  <li>
    <p>Символы первой половины восьмибитной таблицы <strong>ASCII</strong> такие как цифры, латинские символы и 
управляющие символы также представляются и в <strong>UTF-8</strong>, что обеспечивает обратную совместимость <strong>UTF-8</strong> с <strong>ASCII</strong>.</p>
  </li>
  <li>
    <p><strong>UTF-8</strong> использует один фиксированный порядок байтов, поэтому не нужно различать <strong>BE</strong> и <strong>LE</strong>
варианты кодировки.</p>
  </li>
  <li>
    <p>В файлах, закодированных с использование <strong>UTF-8</strong>, нет нулевых байтов, это дает экономичное 
представление текстов и способствует обратной совместимости с <strong>ASCII</strong>.</p>
  </li>
  <li>
    <p>Самая распространенная кодировка в Интернет.</p>
  </li>
</ol>

<h3 id="Недостатки-utf-8">Недостатки <strong>UTF-8</strong>:</h3>

<ol>
  <li>
    <p>Кодовая точка может быть закодирована в 1, 2, 3 или 4 байтах, что усложняет алгоритмы кодировки и 
раскодировки.</p>
  </li>
  <li>
    <p>Существенные затраты на маркировочные биты. Это уменьшает количество значащих бит, которые можно 
было бы использовать. При кодировании в 4 байтах на маркировочные биты приходится более 30% (11 из 32 бит).</p>
  </li>
</ol>

<h3 id="Преимущества-utf-16">Преимущества <strong>UTF-16</strong>:</h3>

<ol>
  <li>
    <p>Символы из <strong>BMP</strong> (основной многоязычной плоскости) в <strong>UTF-16</strong> могут быть представлены 2 
байтами, при этом в <strong>UTF-8</strong> на кодировку символов из BMP может быть затрачено от 1 до 3 байтов, поэтому кодирование с использованием <strong>UTF-8</strong> не всегда более экономичное. Использование фиксированных 2 байтов для текстов из <strong>BMP</strong> ускоряет индексирование и упрощает вычисления. Даже если в тексте присутствуют символы, кодируемые суррогатными парами, индексирование все равно выполняется быстрее.</p>
  </li>
  <li>
    <p>Даже если в кодируемом тексте встречаются символы не из <strong>BMP</strong>, для кодирования которых 
используются суррогатные пары, код кратен 16, что позволяет использовать 16-разрядные типы для работы с <strong>UTF-16</strong>.</p>
  </li>
</ol>

<h3 id="Недостатки-utf-16">Недостатки <strong>UTF-16</strong>:</h3>

<ol>
  <li>
    <p>Использование двух вариантов длины кодирования усложняет кодировку и раскодировку.</p>
  </li>
  <li>
    <p>Много нулевых байтов в строках, состоящих из символов <strong>ASCII</strong>.</p>
  </li>
</ol>

<p>Подведем итог: общим недостатком рассмотренных кодировок является сложность алгоритмов кодирования и раскодирования, что связано с использованием кодирования переменной длины. В <strong>UTF-16</strong> есть всего два варианта длины кода 16 и 32 бита, поэтому для этой кодировки этот недостаток менее выражен. Другим преимуществом этого способа кодирования является быстрая индексация, что крайне важно для больших текстов. Поэтому считается, что <strong>UTF-16</strong> больше подходит для кодирования и хранения больших, особенно многоязычных, текстов. <strong>UTF-8</strong> удобно использовать для сетевых протоколов, в частности в Интернет, так как в этой кодировке не нужно отличать <strong>BE</strong> от <strong>LE</strong> и есть обратная совместимость с <strong>ASCII</strong>.</p>

</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Тестовое задание</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Тестовое задание</li><li><a class="u-email" href="mailto:igriva@list.ru">igriva@list.ru</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/Igriva"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">Igriva</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Тестовое задание на позицию технического писателя от Григорьевой И.В.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
